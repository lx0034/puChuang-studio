<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>后台管理</title>
	<link rel="stylesheet" href="style/animate.css">
	<style>
	/*公共样式*/
	*{
		margin:0;
		padding:0;			
	}
	html{
		/*font-size: 12px;*/
		width:100%;
		height:100%;
		font-family:"microsoft yahei";
		-moz-user-select: none; /*火狐*/
		-webkit-user-select: none; /*webkit浏览器*/
		-ms-user-select: none; /*IE10*/
	}
/*	@media screen and (min-width: 580px){
		html{
			font-size: ;
		}
	}
	@media screen and (min-width: 780px){
		html{
			font-size: 10.5px;
		}
	}*/
	ul,ol{
		list-style: none;
	}
	a{
		text-decoration: none;	
	}
	/*公共样式结束*/
	body{
		width:100%;
		height:100%;
	}
	#mask{
		width:100%;
		height:100%;
		position:fixed;
		display: flex;
		align-items:center;
		justify-content:center;
		top:0;
		left:0;
		background-color:rgba(0,0,0,0.6);
	}
	#mask>div{
		width:60%;
		min-width:360px;
		border:1px solid #000;
		border-radius:8px;
		box-shadow: 5px 8px 20px black;
		background-color:#eee;
	}
	#mask>div>div.win-header{
		width:100%;
		height:60px;
		text-align: center;
		font: bold 30px/60px 'microsoft yahei';
		border-bottom:4px solid #000;
	}
	#mask>div>.win-close{
		width:40px;
		height:40px;
		background-color:#aaa;
		line-height: 40px;
		text-align: center;
		font-size:20px;
		font-weight: bold;
		position:absolute;
		top:0;
		right:0;
		border:none;
		border-radius:0 8px 0 0;
		cursor:pointer;
	}
	#mask>div>.win-close:hover{
		color:#fff;
		background-color:red;
	}
	#mask>div>div.win-content{
/*		display:flex;
		flex-flow:row wrap;
		align-items:center;
		justify-content:space-around;*/
		padding:0 100px 0 100px;
	}
	#mask>div>div.win-content>div{
		margin:10px 0 30px 0;
	}
	#mask>div>div.win-content ol{
		width:100%;
		text-align: center;
		display:flex;
		flex-flow:column wrap;
		align-items:center;
	}
	#mask>div>div.win-content span{
		/*float:left;*/
		font: bold 18px 'microsoft yahei';
	}
	#mask>div>a{
		display: block;
		width:200px;
		height:40px;
		line-height: 40px;
		text-align: center;
		background-color:#aaa;
		color:#444;
		float:right;
		border-radius:8px;
		margin:0 80px 20px 0;
	}
	#mask>div>a:hover{
		color:#fff;
		background-color:#aad7ec;
	}
	#header{
		width:100%;
		height:450px;
		background-color:#eee;
		display:flex;
		flex-flow:row wrap;
		align-items:center;
		justify-content:space-around;
	}
	#header>h1{
		font-size: 40px;
		font-weight: normal;
	}
	#section{
		height:auto;
		padding:50px 0 100px 0;
		
	}
	#section>div{
		width:100%;
		text-align: center;
		
		display: flex;
		flex-flow:row wrap;
		align-items:center;
		justify-content:space-around;
	}

	#section>div>ul{
		width:70%;
		overflow: hidden;
		font-size: 0;
		transition:0.3s;
		border-left:1px solid #999;
	}
	#section>div>ul.sele{
		transform:translateY(-15%);
		box-shadow: 3px 5px 10px black;
	}
	#section>div>ul:last-child{
		border-bottom:1px solid #999;
	}
	#section>div>ul>li{
		display:inline-block;
		box-sizing:border-box;
		width:20%;
		font-size: 16px;
		height:40px;
		line-height: 40px;
		text-align: center;
		border-right:1px solid #999;
		border-top:1px solid #999;
	}
	#section>div>ul>li:nth-of-type(2n){
		background: #e2f5fb;
	}
	#section>div>ul>li:nth-of-type(2n+1){
		background: #fff;
	}
	#section>div>ul>li:hover{
		background-color: #ace9ff;
	}
	#section>div>ul>li>a{
		display:block;
		color:#444;
		width:100%;
		height:100%;
		cursor:pointer;
	}
	#section>div>ul>li>a:hover{
		color:#fff;
		background-color: #0492f4;
	}

	#footer{
		width:100%;
		height:450px;
		background-color: #eee;
	}

	</style>
</head>
<body>
	<header id="header" class="animated bounceInDown">
		<h1>成员后台管理</h1>
	</header>
	<section id="section">
		<div class="animated bounceInLeft">
			<ul>
				<li>姓名</li>
				<li>手机</li>
				<!-- <li>邮箱</li> -->
				<li><a href="javascript:;">详 情</a></li>
			</ul>
		</div>
	</section>
	<footer id="footer">
	</footer>
	<div id="mask" style="display:none;">
		<div class="animated fadeInUp">
			<button class="win-close">X</button>
			<div class="win-header">姓名</div>
			<div class="win-content">
				<div>
					<span>本周计划 : </span>
					<ol>
						<!-- <li>计划一</li> -->
<!-- 						<li>计划二</li>
						<li>计划三</li> -->
					</ol>
				</div>
<!-- 				<div>
					<span>上周计划 : </span>
					<ol>
						<li>计划一</li>
						<li>计划二</li>
						<li>计划三</li>
					</ol>
				</div> -->
			</div>
			<a href="javascript:;">more...</a>
		</div>		
	</div>
	<script>
		var mainObj = {
			ulOver: function(ev){

				var ev = ev || window.event;
				if(ev.target.nodeName.toLowerCase() === 'li'){
					ev.target.parentNode.classList.add('sele');
				}else if(ev.target.nodeName.toLowerCase() === 'a'){
					ev.target.parentNode.parentNode.classList.add('sele');
				}
			},

			ulOut: function(ev){
				var ev = ev || window.event;
				if(ev.target.nodeName.toLowerCase() === 'li'){
					ev.target.parentNode.classList.remove('sele');
				}else if(ev.target.nodeName.toLowerCase() === 'a'){
					ev.target.parentNode.parentNode.classList.remove('sele');
				}
			},

			aClick: function(obj){
				return function(ev){
					var ev = ev || window.event;
					if(ev.target.nodeName.toLowerCase() === 'a'){
						mainObj.ajax('http://localhost/WEPAPI/history_plans.php', mainObj.ajax2Handle, ev.target.dataset.num);
						// console.log(this.getElementsByClassName('sele'));
						obj.style.display = 'flex';
					}
					
				};
			},

			win_close: function(ele){
				return function(){
					ele.style.display = 'none';
				};
			},

			ajaxHandle: function(dataObj){
				var oDiv = document.querySelector('#section>div');
				var aUl = document.querySelectorAll('#section>div>ul');
				var aLi = document.getElementsByTagName('li');
				var oFrag = document.createDocumentFragment();
				var arr = [];
				var num = mainObj.getJsonObjLength(dataObj.data[0][0]) + 1;
					for(var i = 0;i < dataObj.data[0].length;i++){
						var cUl = document.createElement('ul');
						var cLi = document.createElement('li');
						var cA = document.createElement('a');
						cA.setAttribute('data-num',i);
						cA.setAttribute('onclick','return false');
						cA.innerHTML = '详 情';
						cLi.appendChild(cA);
						cUl.appendChild(cLi);

						for(var attr in dataObj.data[0][i]){
							var cLi = document.createElement('li');
							cLi.innerHTML = dataObj.data[0][i][attr];
							oFrag.appendChild(cLi);
						}

						cUl.insertBefore(oFrag,cUl.lastElementChild);
						oDiv.appendChild(cUl);					
					}
				if( num == 0 ){
					for(var i=0;i < aUl.length;i++){
						aUl[i].style.display = 'none';
					}
				}else{
					for(var i=0;i < aLi.length;i++){
						aLi[i].style.width = mainObj.toPercent(1/num);
					}
				}
			},

			ajax2Handle: function(dataObj,sele){
				console.log(dataObj);
				var owin = document.getElementById('mask');
				var oHeader = document.querySelector('#mask .win-header');
				var oContent = document.querySelector('#mask .win-content');
				oHeader.innerHTML = dataObj.data[sele].admin_rank;
				var aOl = oContent.getElementsByTagName('ol')[0];
				var cFrag = document.createDocumentFragment();

				for(var attr in dataObj.data[sele].last_sum){
					console.log(dataObj.data[sele].last_sum[attr]);
					var cLi = document.createElement('li');
					cLi.innerHTML = dataObj.data[sele].last_sum[attr];
					cFrag.appendChild(cLi);
				}
				aOl.appendChild(cFrag);
					
			},

			toPercent: function(data){
			  var strData = parseFloat(data)*100;
			  var ret = strData.toString()+"%";
			  return ret;
			},

			getJsonObjLength: function(jsonObj) {
			        var Length = 0;
			        for (var item in jsonObj) {
			            Length++;
			        }
			        return Length;
			},

			ajax: function(url,handle,eleObj){
				var xhr = new XMLHttpRequest();
				xhr.onreadystatechange = function(){
					if(xhr.readyState == 4){
						if(xhr.status >=200 && xhr.status < 300 || xhr.status == 304){
							var json = JSON.parse(xhr.responseText);
							handle(json,eleObj);
						}
					}
				};
				xhr.open('get',url,true);
				xhr.send(null);
			}
		};


		(function(){
			var oMask = document.getElementById('mask');
			var oUl = document.getElementsByTagName('ul');
			var oDiv = document.querySelector('#section>div');
			var aA = document.querySelectorAll('#section a');
			var oClose = document.querySelector('#mask .win-close');

			mainObj.ajax('http://localhost/WEPAPI/user_list.php',mainObj.ajaxHandle,null);
			

			//ul添加mouseover事件
			oDiv.addEventListener('mouseover',mainObj.ulOver,false);
			oDiv.addEventListener('mouseout',mainObj.ulOut,false);

			//a添加点击事件
			oDiv.addEventListener('click',mainObj.aClick(oMask),false);

			//添加点击事件
			oClose.addEventListener('click',mainObj.win_close(oMask),false);
			
		})();
	</script>
</body>
</html>